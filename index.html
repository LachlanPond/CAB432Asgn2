<html>
  <head>
    <link rel="stylesheet" type="text/css" href="./style.css">
    <title>Twitter Analysis</title>
  </head>
  <body>

    <header id="pageHeader">
      <h1 id="mainLogo">Twitter Sentimental Analysis</h1>
      <a href="/"><h2>Home</h2></a>
      <a href="/statistics"><h2>Analytics</h2></a>
      <a href="/viewmessages"><h2>User searches</h2></a>
    </header>

    <nav id="mainNav">
      
    </nav>
    <div id="siteAds"></div>
    
    <article id="mainArticle"> 

    <form id ="message-entry" method="post" action="javascript:sendFormContent()">
      <h1>by Luke Pritchard & Lachlan Pond</h1>
      <h4>Please enter key words to search including hashtags seperated by a comma</h4>
      <input type="Text" name="text" id="text"><br><br>
      <input type="submit" id="submit" value="Go">
    </form>
  <h2>Results</h2>

  <table id="messages" style="margin:auto;">
      <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
  </table>


      </article>
  </body>

  <script src="http://d3js.org/d3.v4.min.js"></script>
  <script src="https://d3js.org/d3-dsv.v1.min.js"></script>
  <script src="d3visuals.js"></script>
  <script src="textManipulation.js"></script>

  <script>

    //Onload of screen display data
    onload = conversation();
    
    function conversation() {
      //  $.get('/tweets', function (data) {
       // readMsg(data);
     // });

      $.get('/messages', function (data) {
        document.getElementById("text").value = data[data.length-1].text;
      });
      loadDoc();
    }

    // Refresh screen after 6 seconds; 
    setInterval(function() {
       loadDoc();
    }, 1000);

  function loadDoc() {
  
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      document.getElementById("messages").innerHTML =
      this.responseText;
    }
  };
  
  xhttp.open("GET", "/top15.txt", true);
  
  xhttp.send();

  }

    //Send form
    function sendFormContent() {
      var form = $('#message-entry');
      var query = form.serialize();

      $.post('/messages', query, function (data) {
        readMsg(data);
      });

      $.post('/tweets', query, function (data) {
        readMsg(data);
      });
      
    }

    function readMsg(data) {
      for (var i = 14; i > -1; i--) {
        var msg = data[i];
        var output = '<h3>'+msg.name+' (@'+msg.username+')</h3>';
        output += '<p>'+msg.tweet+'</p>'; 
        output += '<p><i>'+msg.time+'</i></p>';  
        $("#messages").prepend(output); 
      }
    }

  </script>
      
</html>